<!--voter_analytics/templates/voter_analytics/voter_list.html-->
<!--Ting Shing Liu, 10/31/25-->
<!--Page template for the Voter List-->
{% extends 'voter_analytics/base.html' %}
{% load static %}

{% block content %}
    <h1>Newton Voter List</h1>
    <div class="nav">
         <a href="{% url 'graphs' %}">View Data Graphs →</a>
    </div>
    <div class="filter-form">
        <h3>Filter Voters</h3>
        <form method="GET" action="{% url 'voters' %}">
            <div>
                <label for="party">Party:</label>
                <select name="party" id="party">
                    <option value="">All Parties</option>
                    {% for party in party_options %}
                        <option value="{{ party }}" {% if current_filters.party == party %}selected{% endif %}>
                            {{ party }}
                        </option>
                    {% endfor %}
                </select>

                <label for="min_year">Born After:</label>
                <select name="min_year" id="min_year">
                    <option value="">Any Year</option>
                    {% for year in year_options %}
                        <option value="{{ year }}" {% if current_filters.min_year|add:0 == year %}selected{% endif %}>
                            {{ year }}
                        </option>
                    {% endfor %}
                </select>

                <label for="max_year">Born Before:</label>
                <select name="max_year" id="max_year">
                    <option value="">Any Year</option>
                    {% for year in year_options %}
                        <option value="{{ year }}" {% if current_filters.max_year|add:0 == year %}selected{% endif %}>
                            {{ year }}
                        </option>
                    {% endfor %}
                </select>

                <label for="voter_score">Voter Score:</label>
                <select name="voter_score" id="voter_score">
                    <option value="">All Scores</option>
                    {% for score in score_options %}
                        <option value="{{ score }}" {% if current_filters.voter_score|add:0 == score %}selected{% endif %}>
                            {{ score }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <strong>Voted In:</strong>
                <label><input type="checkbox" name="v20state" value="True" {% if current_filters.v20state %}checked{% endif %}> '20 State</label>
                <label><input type="checkbox" name="v21town" value="True" {% if current_filters.v21town %}checked{% endif %}> '21 Town</label>
                <label><input type="checkbox" name="v21primary" value="True" {% if current_filters.v21primary %}checked{% endif %}> '21 Primary</label>
                <label><input type="checkbox" name="v22general" value="True" {% if current_filters.v22general %}checked{% endif %}> '22 General</label>
                <label><input type="checkbox" name="v23town" value="True" {% if current_filters.v23town %}checked{% endif %}> '23 Town</label>
            </div>
            
            <button type="submit">Filter</button>
            <a href="{% url 'voters' %}">Clear Filters</a>
        </form>
    </div>

    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Address</th>
                <th>Date of Birth</th>
                <th>Party</th>
                <th>Score</th>
                <th>Details</th>
            </tr>
        </thead>
        <tbody>
            {% for voter in voters %}
            <tr>
                <td>{{ voter.first_name }} {{ voter.last_name }}</td>
                <td>
                    {{ voter.street_number }} {{ voter.street_name }}
                    {% if voter.apartment_number %}
                        Apt {{ voter.apartment_number }}
                    {% endif %}
                </td>
                <td>{{ voter.date_of_birth }}</td>
                <td>{{ voter.party_affiliation }}</td>
                <td>{{ voter.voter_score }}</td>
                <td>
                    <a href="{% url 'voter' voter.pk %}">View Details</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6">No voters found matching your criteria.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="pagination">
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?{{ current_filters.urlencode }}&page=1">« first</a>
                <a href="?{{ current_filters.urlencode }}&page={{ page_obj.previous_page_number }}">previous</a>
            {% endif %}

            <span class="current">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
            </span>

            {% if page_obj.has_next %}
                <a href="?{{ current_filters.urlencode }}&page={{ page_obj.next_page_number }}">next</a>
                <a href="?{{ current_filters.urlencode }}&page={{ page_obj.paginator.num_pages }}">last »</a>
            {% endif %}
        </span>
    </div>
{% endblock %}